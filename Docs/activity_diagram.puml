@startuml "ActivityDiagram"
title Activity Diagram: OIDC Authorization Code Flow

|Користувач (з User Agent)|
start
:Ініціює логін;

|Клієнт|
:Генерація запиту на авторизацію;
:Redirect на сервер авторизації;

|Сервер авторизації|
repeat
  :Відображення сторінки входу;
  
  |Користувач (з User Agent)|
  :Введення облікових даних;
  
  |Сервер авторизації|
  :Перевірка облікових даних;

backward:Показати помилку;
repeat while (Облікові дані валідні?) is (ні) not (так)

:Створення сесії (з Cookie);
:Генерація коду авторизації;
:Редирект на клієнт з кодом;

|Клієнт|
:Запит з Auth Code + Client Secret\n до /token;

|Сервер авторизації|
if (Код та Secret валідні?) then (так)
  :Генерація JWT токенів;
  :Повернення токенів;
else (ні)
  :Повернення помилки;
  |Клієнт|
  :Показати сторінку помилки;
  stop
endif

|Клієнт|
:Валідація ID-токена;
:Створення локальної\n сесії користувача;

|Користувач (з User Agent)|
:Доступ до захищених ресурсів;
stop
@enduml