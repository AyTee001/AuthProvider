@startuml "ActivityDiagram_Simplified"
title OIDC Authorization Code Flow

|Користувач|
start
:Ініціює логін;

|Клієнт|
:Формування запиту\nавторизації;
:Перенаправлення\nна сервер авторизації;

|Сервер авторизації|
repeat
  :Відображення сторінки входу;

|Користувач|
  :Введення\nоблікових даних;

|Сервер авторизації|
  :Перевірка облікових даних;
  
  if (Дані валідні?) then (так)
    break
  else (ні)
    :Помилка автентифікації;
  endif
repeat while (Спроби\nне вичерпано?) is (так)

stop

:Створення сесії;
:Генерація коду авторизації;
:Редирект на клієнт з кодом;

|Клієнт|
:Обмін коду на токени;

|Сервер авторизації|
:Валідація запиту\n(Authorization Code + PKCE);

if (Запит валідний?) then (так)
  :Генерація JWT токенів;
  :Повернення токенів;
else (ні)
  :Повернення помилки;
  stop
endif

|Клієнт|
:Створення локальної\nсесії;

|Користувач|
:Доступ до\nзахищених ресурсів;
stop
@enduml
