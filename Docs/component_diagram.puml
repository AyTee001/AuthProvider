@startuml "Component Diagram"
title Діаграма компонентів системи автентифікації/авторизації

skinparam componentStyle uml2

' --- Клієнт ---
component "Клієнтський додаток (MVC)" as Client {
    component "OpenIddict Client Services" as OpenIddictClient
}

' --- Інтерфейси ---
together {
    interface "OIDC Protocol endpoints" as OidcInterface
    interface "Discovery (.well-known)" as DiscoveryInterface
    interface "REST API\n(Data Access)" as ApiInterface
}

' --- Auth Server ---
component "Сервер авторизації" as AuthServer {
    component "Identity Management UI" as IdentityUI
    component "OIDC endpoints" as OidcEndpoints
    component "OpenIddict Server Services" as OpenIddictServer
    component "ASP.NET Core Identity Services" as IdentityCore
    component "Entity Framework Core\n(DbContext + Stores)" as EfCore

    OidcEndpoints ..> OpenIddictServer : "Опрацювання\nзапитів"
    OidcEndpoints ..> IdentityCore : "Отримання\nавтентифікованого\nClaims Principal"
    IdentityUI ..> IdentityCore : "Управління\nідентичністю користувача"
    OpenIddictServer ..> EfCore : "Запис даних для\nавтентифікації та авторизації"
    IdentityCore ..> EfCore : "Запис облікових\nданих користувачів"
}

component "Сервер ресурсів (API)" as ResourceServer {
    component "Request Middleware" as RequestMiddleware
    component "OpenIddict Validation Services" as OpenIddictValidation
    component "Resource Controllers" as ResourceControllers

    RequestMiddleware ..> OpenIddictValidation : "Валідація токенів"
    ResourceControllers ..> RequestMiddleware : "Захищається"
}

' --- БД ---
database "SQL Database" as DB

' --- Зовнішні зв'язки ---
Client --> OidcInterface : "OIDC /\nOAuth 2.0"
Client --> ApiInterface : "Запит з\nAccess token"

OidcInterface -- OidcEndpoints
DiscoveryInterface -- OpenIddictServer
ApiInterface -- ResourceControllers

OpenIddictValidation --> DiscoveryInterface : "Signing Keys (JWKS)"

EfCore .> DB : "CRUD операції"

@enduml