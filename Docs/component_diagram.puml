@startuml "Component Diagram"
title Діаграма компонентів системи автентифікації/авторизації

skinparam componentStyle uml2
skinparam linetype ortho

component "Клієнтський додаток (MVC)" as Client {
    component "OpenIddict Client Services" as OpenIddictClient
}

component "Сервер авторизації" as AuthServer {
    component "Identity Management UI" as IdentityUI
    component "OIDC endpoints" as OidcEndpoints
    component "Discovery endpoints" as DiscoveryEndpoints
    component "OpenIddict Server Services" as OpenIddictServer
    component "ASP.NET Core Identity Services" as IdentityCore
    component "Entity Framework Core\n(DbContext + Stores)" as EfCore

    OidcEndpoints ..> OpenIddictServer : "Опрацювання запитів"
    OidcEndpoints ..> IdentityCore : "Отримання автентифікованого Claims Principal"
    IdentityUI ..> IdentityCore : "Управління ідентичністю користувача"
    DiscoveryEndpoints ..> OpenIddictServer : "Імплементація"
    OpenIddictServer ..> EfCore : "Запис даних для автентифікації та авторизації"
    IdentityCore ..> EfCore : "Запис облікових даних користувачів"
}

component "Сервер ресурсів (API)" as ResourceServer {
    component "Request Middleware" as RequestMiddleware
    component "OpenIddict Validation Services" as OpenIddictValidation
    component "Resource Controllers" as ResourceControllers

    RequestMiddleware ..> OpenIddictValidation : "Валідація токенів"
    ResourceControllers ..> RequestMiddleware : "Захищається"
}

database "SQL Database" as DB

EfCore ..> DB : "CRUD операції над даними"

interface "OIDC Protocol endpoints" as OidcInterface
OidcInterface -- AuthServer
Client ..> OidcInterface : "Взаємодія через OIDC / OAuth 2.0"

interface "Discovery (.well-known)" as DiscoveryInterface
DiscoveryInterface -- AuthServer
OpenIddictValidation ..> DiscoveryInterface : "Отримання Signing Keys (JWKS)"

interface "REST API\n(Data Access)" as ApiInterface
ApiInterface -- ResourceServer
Client ..> ApiInterface : "Запит з Access token"

@enduml